================================================================================
                        GADI BULAO - COMPLETE PROJECT DOCUMENTATION
================================================================================

Created: December 2024
Author: [Your Name]
Technologies: React Native (Expo), Node.js, MongoDB, Socket.io

================================================================================
                              PROJECT OVERVIEW
================================================================================

Gadi Bulao is a ride-hailing application similar to Uber/Ola, built with:

FRONTEND (Mobile App):
- React Native with Expo SDK 54
- TypeScript for type safety
- Zustand for state management
- Socket.io-client for real-time communication
- OpenStreetMap for maps (free alternative to Google Maps)

BACKEND (Server):
- Node.js with Express.js
- MongoDB with Mongoose ODM
- Socket.io for real-time WebSocket communication
- JWT for authentication
- Geohash for zone-based driver matching

================================================================================
                              PROJECT STRUCTURE
================================================================================

Gadi bulao/
|
|-- mobile/                 <- React Native Mobile App
|   |-- app/                <- Expo Router screens (pages)
|   |-- src/                <- Source code
|   |-- assets/             <- Images, fonts, etc.
|   |-- package.json        <- Dependencies
|   |-- app.json            <- Expo configuration
|   |-- eas.json            <- EAS Build configuration
|
|-- server/                 <- Node.js Backend Server
|   |-- src/                <- Server source code
|   |-- package.json        <- Server dependencies
|   |-- .env                <- Environment variables (NOT in git)


================================================================================
                         MOBILE APP (mobile/ folder)
================================================================================

1. mobile/app/ - EXPO ROUTER SCREENS
--------------------------------------------------------------------------------
These are the "pages" of your app. Expo Router uses file-based routing.

- _layout.tsx          : Root layout that wraps entire app with providers
                         (GestureHandler, SafeArea, WebSocket Provider)

- index.tsx            : Landing page - Role selection (Customer/Driver)
                         User chooses whether they want to ride or drive

- auth/
  - phone-login.tsx    : Login/Registration screen
                         Collects phone number, name, and vehicle details for drivers

- customer/
  - home.tsx           : Customer home screen with map
                         - Shows current location on map
                         - Location search bars (pickup & dropoff)
                         - Vehicle type selection (Bike/Auto/Cab)
                         - Fare display and booking button

  - liveRide.tsx       : Live ride tracking for customers
                         - Shows driver location in real-time
                         - Displays OTP codes for verification
                         - Shows ride status (Accepted -> Arrived -> Started -> Completed)
                         - Rating modal after ride completion

- rider/
  - home.tsx           : Driver home screen
                         - On/Off duty toggle
                         - Shows current location on map
                         - Displays incoming ride requests
                         - Shows earnings and ride count

  - liveRide.tsx       : Active ride screen for drivers
                         - Navigation to pickup/dropoff
                         - Status buttons (Arrived, Start Ride, Complete Ride)
                         - OTP verification before starting/completing ride


2. mobile/src/components/ - REUSABLE UI COMPONENTS
--------------------------------------------------------------------------------

customer/
  - DraggableMap.tsx       : Interactive map where customer can drag marker
  - DraggableMap.native.tsx: Native (iOS/Android) version using react-native-maps
  - DraggableMap.web.tsx   : Web version using Leaflet maps
  - LocationBar.tsx        : Search bar for location input with autocomplete
  - RideBookingSheet.tsx   : Bottom sheet showing vehicle options and prices

rider/
  - RiderHeader.tsx        : Header with driver name, duty toggle, earnings
  - RiderMap.tsx           : Map showing driver's current location
  - RiderMap.native.tsx    : Native version of rider map
  - RiderMap.web.tsx       : Web version of rider map
  - RideRequestItem.tsx    : Card showing incoming ride request details

common/
  - LiveRideMap.tsx        : Map showing real-time ride progress
  - OTPDisplay.tsx         : Shows OTP codes to customer
  - OTPInputModal.tsx      : Modal for driver to enter OTP
  - RatingModal.tsx        : Star rating modal after ride completion

shared/
  - PhoneInput.tsx         : Phone number input with country code
  - CustomButton.tsx       : Styled button component


3. mobile/src/services/ - API & SOCKET SERVICES
--------------------------------------------------------------------------------

- apiClient.ts    : HTTP API client using fetch
                    - Handles authentication tokens
                    - Automatic token refresh on 401 errors
                    - API endpoints for login, profile, fare calculation

- socketService.ts: WebSocket client using Socket.io
                    - Connects to server with JWT token
                    - Emits events: requestRide, cancelRide, acceptRide, etc.
                    - Listens for: newRideRequest, rideAccepted, rideStatusUpdate
                    - Handles reconnection automatically

- mapService.ts   : OpenStreetMap services
                    - searchPlaces(): Search for locations using Nominatim API
                    - reverseGeocode(): Convert coordinates to address
                    - getRoute(): Get driving directions using OSRM


4. mobile/src/store/ - STATE MANAGEMENT (Zustand)
--------------------------------------------------------------------------------

- userStore.ts    : User authentication and profile state
                    - isAuthenticated, accessToken, refreshToken
                    - user profile (name, phone, role)
                    - login(), logout(), hydrate() (restore from storage)
                    - activeRide for customer's current ride

- riderStore.ts   : Driver-specific state
                    - isOnDuty, currentZone
                    - earnings, totalRides, rating
                    - rideRequests[] - incoming ride requests
                    - activeRide - currently accepted ride

- storage.ts      : AsyncStorage helpers
                    - Save/load tokens and user data
                    - Persist state across app restarts


5. mobile/src/config/ - CONFIGURATION
--------------------------------------------------------------------------------

- environment.ts  : App configuration
                    - API_URL: Backend server URL (Render deployment)
                    - SOCKET_CONFIG: WebSocket connection settings
                    - MAP_CONFIG: Default map region (Delhi)

- colors.ts       : Color palette for consistent styling

- vehicleTypes.ts : Vehicle type definitions with pricing info


6. mobile/src/context/ - REACT CONTEXT PROVIDERS
--------------------------------------------------------------------------------

- WSProvider.tsx  : WebSocket Provider
                    - Manages socket connection lifecycle
                    - Auto-connects when user is authenticated
                    - Handles token refresh on connection failure
                    - Provides socket to all child components via useSocket()


7. mobile/src/types.ts - TYPE DEFINITIONS
--------------------------------------------------------------------------------
TypeScript interfaces for:
- Location (latitude, longitude, address)
- User profiles
- Ride data structures


================================================================================
                         SERVER (server/ folder)
================================================================================

1. server/src/index.js - MAIN SERVER FILE
--------------------------------------------------------------------------------
Entry point that:
- Initializes Express.js server
- Sets up Socket.io for WebSockets
- Connects to MongoDB
- Registers API routes
- Serves admin panel static files


2. server/src/config/ - SERVER CONFIGURATION
--------------------------------------------------------------------------------

- db.js           : MongoDB connection using Mongoose
                    Connects to MongoDB Atlas cloud database


3. server/src/models/ - DATABASE SCHEMAS
--------------------------------------------------------------------------------

- User.js         : User model with fields:
                    - phone, name, role (customer/rider)
                    - refreshToken for authentication
                    - customerProfile { rating, totalRides, savedLocations }
                    - riderProfile { vehicle, isOnDuty, earnings, location }

- Ride.js         : Ride model with fields:
                    - customer, rider (references to User)
                    - pickup, dropoff (coordinates + address)
                    - vehicleType (bike/auto/cab)
                    - status (SEARCHING/ACCEPTED/ARRIVED/STARTED/COMPLETED/CANCELLED)
                    - fare { distanceKm, pricePerKm, totalAmount }
                    - otp { startOtp, endOtp } for verification
                    - timestamps for each status change


4. server/src/controllers/ - API LOGIC
--------------------------------------------------------------------------------

- authController.js : Authentication endpoints
                      - phoneLogin: Create/login user
                      - refreshToken: Get new access token
                      - switchRole: Change customer<->rider
                      - registerRider: Add vehicle details
                      - getProfile: Get user data
                      - getAllUsers/getAllDrivers: Admin endpoints

- rideController.js : Ride management endpoints
                      - calculateFare: Get price before booking
                      - getHistory: Past rides for user
                      - getRideById: Ride details
                      - getActiveRides: Admin - all active rides


5. server/src/services/ - BUSINESS LOGIC
--------------------------------------------------------------------------------

- socketService.js  : WebSocket event handlers

  CUSTOMER EVENTS:
  - requestRide: Create ride, broadcast to nearby drivers
  - cancelRide: Cancel ride, notify drivers/riders

  DRIVER EVENTS:
  - goOnDuty: Start accepting rides, subscribe to zone
  - goOffDuty: Stop accepting rides
  - rideAccepted: Accept a ride request
  - rideArrived: Mark arrived at pickup
  - rideStarted: Start ride (OTP verification required)
  - rideCompleted: Complete ride (OTP verification required)
  - updateLocation: Send location to customer

- zoneManager.js    : Geospatial zone management
                      - Uses geohash to divide map into zones
                      - Tracks which drivers are in which zones
                      - Filters drivers by vehicle type
                      - Ensures ride requests only go to matching drivers


6. server/src/middleware/ - REQUEST MIDDLEWARE
--------------------------------------------------------------------------------

- auth.js           : JWT authentication
                      - authenticate: Verify JWT token for API routes
                      - authenticateSocket: Verify token for WebSocket connections


7. server/src/utils/ - HELPER FUNCTIONS
--------------------------------------------------------------------------------

- jwt.js            : JWT token utilities
                      - generateTokenPair: Create access + refresh tokens
                      - verifyAccessToken / verifyRefreshToken

- geospatial.js     : Geolocation utilities
                      - calculateDistance: Haversine formula for distance
                      - encodeGeohash: Convert coordinates to geohash string
                      - getNeighborZones: Get surrounding zones

- fareCalculator.js : Fare calculation
                      - Different rates for bike/auto/cab
                      - Base fare + per km rate + minimum fare


8. server/src/routes/ - API ROUTES
--------------------------------------------------------------------------------

- auth.js           : /api/auth/* routes
                      - POST /login
                      - POST /refresh
                      - POST /switch-role
                      - POST /register-rider
                      - GET /profile
                      - GET /users (admin)
                      - GET /drivers (admin)

- ride.js           : /api/rides/* routes
                      - POST /calculate-fare
                      - GET /history
                      - GET /:rideId
                      - GET /active (admin)


9. server/src/public/ - STATIC FILES
--------------------------------------------------------------------------------

- admin.html        : Web admin dashboard
                      - View all rides, users, drivers
                      - Manage users (edit/delete)
                      - Dashboard with statistics


================================================================================
                         HOW THE APP WORKS (FLOW)
================================================================================

1. CUSTOMER BOOKING FLOW:
   - Customer opens app, logs in
   - Enters pickup & dropoff locations
   - Selects vehicle type (bike/auto/cab)
   - Sees fare estimate
   - Clicks "Book Ride"
   - App sends requestRide via WebSocket
   - Server creates ride with status SEARCHING
   - Server broadcasts to all matching drivers in nearby zones
   - Customer waits for driver acceptance

2. DRIVER ACCEPTANCE FLOW:
   - Driver goes "On Duty"
   - Server subscribes driver to their zone
   - Driver receives ride request notification
   - Driver clicks "Accept"
   - Server updates ride status to ACCEPTED
   - Server generates OTP codes
   - Customer receives driver details + OTP
   - Other drivers receive "ride unavailable"

3. RIDE EXECUTION FLOW:
   - Driver navigates to pickup location
   - Driver clicks "Arrived" (status: ARRIVED)
   - Driver asks customer for Start OTP
   - Driver enters OTP to start ride (status: STARTED)
   - Customer sees live driver location
   - Driver reaches dropoff
   - Driver asks customer for End OTP
   - Driver enters OTP to complete ride (status: COMPLETED)
   - Both parties can rate each other


================================================================================
                         TECHNOLOGIES EXPLAINED
================================================================================

1. EXPO (React Native Framework)
   - Makes React Native development easier
   - Provides pre-configured build system
   - EAS Build for generating APK/IPA files

2. SOCKET.IO
   - Real-time bidirectional communication
   - WebSocket with fallback to polling
   - Used for: ride requests, live location updates, status changes

3. MONGODB
   - NoSQL document database
   - Stores users, rides in JSON-like documents
   - MongoDB Atlas for cloud hosting (free tier)

4. GEOHASH
   - Encodes latitude/longitude into string
   - Nearby locations have similar prefixes
   - Used to efficiently find drivers near pickup location

5. JWT (JSON Web Tokens)
   - Stateless authentication
   - Access token (15 min) + Refresh token (7 days)
   - No need to store sessions on server

6. ZUSTAND
   - Lightweight state management for React
   - Simpler than Redux
   - Used for user state, ride state, etc.


================================================================================
                         COMMON QUESTIONS & ANSWERS
================================================================================

Q: How does the app find drivers near the customer?
A: The app uses geohash-based zones. When a customer books, the server finds
   all drivers in the same zone and neighboring zones, filtered by vehicle type.

Q: How is the fare calculated?
A: Fare = Base Fare + (Distance in km * Price per km)
   - Bike: Base ₹20, ₹8/km, min ₹30
   - Auto: Base ₹30, ₹12/km, min ₹50
   - Cab:  Base ₹50, ₹15/km, min ₹80

Q: How does OTP verification work?
A: When a driver accepts a ride, the server generates two random 4-digit OTPs:
   - Start OTP: Driver enters this to start the ride (given by customer)
   - End OTP: Driver enters this to complete the ride (given by customer)
   This ensures the right customer is picked up and dropped off.

Q: How is the driver's location tracked?
A: When the driver is on an active ride, the app sends location updates every
   5 seconds via WebSocket. The server forwards these to the customer's app.

Q: What happens if the connection drops?
A: Socket.io automatically reconnects. The app retries up to 10 times with
   increasing delays. If the token expires, it automatically refreshes.

Q: How is authentication handled?
A: JWT tokens are used. Access token expires in 15 minutes, refresh token in
   7 days. When access token expires, the app uses refresh token to get new ones.


================================================================================
                         DEPLOYMENT INFORMATION
================================================================================

BACKEND SERVER:
- Hosted on: Render (https://render.com)
- URL: https://gadi-bulao-backend.onrender.com
- Database: MongoDB Atlas (cloud)
- Note: Free tier sleeps after 15 min of inactivity, takes ~50 sec to wake up

MOBILE APP:
- Built with: EAS Build (Expo Application Services)
- APK: Android Package file
- Distribution: Can be installed directly or via Play Store

ADMIN PANEL:
- URL: https://gadi-bulao-backend.onrender.com/admin
- Web-based dashboard for managing rides and users


================================================================================
                              FILE QUICK REFERENCE
================================================================================

MOST IMPORTANT FILES:

Mobile:
- mobile/app/_layout.tsx        : App entry point
- mobile/app/customer/home.tsx  : Main customer screen
- mobile/app/rider/home.tsx     : Main driver screen
- mobile/src/services/socketService.ts : Real-time communication
- mobile/src/store/userStore.ts : User state management

Server:
- server/src/index.js           : Server entry point
- server/src/services/socketService.js : All WebSocket handlers
- server/src/models/User.js     : User database schema
- server/src/models/Ride.js     : Ride database schema


================================================================================
                         END OF DOCUMENTATION
================================================================================
